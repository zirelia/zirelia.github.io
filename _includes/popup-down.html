<!-- Popup CTA -->
<div id="cta-popup"
  class="hidden fixed bottom-6 right-6 max-w-sm w-full bg-white dark:bg-neutral-900 border border-gray-200 dark:border-white/10 rounded-2xl shadow-2xl z-50 transform translate-y-10 opacity-0 transition-all duration-500">

  <!-- Close Button -->
  <button id="cta-close-btn" aria-label="Close"
    class="absolute top-3 right-3 text-gray-400 hover:text-black dark:hover:text-white transition-colors">
    <i class="fas fa-times"></i>
  </button>

  <div class="p-6">
    <div class="w-10 h-10 rounded-full bg-brand-blue/10 flex items-center justify-center mb-4 text-brand-blue text-lg">
      <i class="fas fa-rocket"></i>
    </div>

    {% if page.lang == 'it' %}
    <h4 class="text-lg font-bold mb-2 text-neutral-900 dark:text-white">Costruisci il tuo Agente</h4>
    <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
      Non aspettare i competitor. Trasforma Salesforce in un motore autonomo oggi stesso.
    </p>

    <a href="/it/pricing/"
      class="block w-full py-3 rounded-xl bg-black dark:bg-white text-white dark:text-black font-bold text-center hover:bg-brand-blue dark:hover:bg-brand-blue dark:hover:text-white transition-colors">
      Diventa Partner Fondatore
    </a>
    {% else %}
    <h4 class="text-lg font-bold mb-2 text-neutral-900 dark:text-white">Build Your First Agent</h4>
    <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
      Don't let competitors get ahead. Turn Salesforce into an autonomous engine today.
    </p>

    <a href="/en/pricing/"
      class="block w-full py-3 rounded-xl bg-black dark:bg-white text-white dark:text-black font-bold text-center hover:bg-brand-blue dark:hover:bg-brand-blue dark:hover:text-white transition-colors">
      Become a Founding Partner
    </a>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const cta = document.getElementById("cta-popup");
    const closeBtn = document.getElementById("cta-close-btn");

    // Internal state to prevent reappearance in same session
    let isDismissed = localStorage.getItem('cta_popup_closed') === 'true';



    // Only add scroll listener if not already dismissed globally
    if (!isDismissed) {
      window.addEventListener("scroll", function () {
        // Double check state inside listener
        if (isDismissed) return;

        const docHeight = document.documentElement.scrollHeight;
        const scrollPos = window.scrollY + window.innerHeight;
        const scrollPercent = (scrollPos / docHeight) * 100;

        if (scrollPercent > 50) {
          cta.classList.remove('hidden');
          // Small delay to allow display:block to apply before opacity transition
          setTimeout(() => {
            cta.classList.remove('translate-y-10', 'opacity-0');
          }, 10);
        }
      });
    }

    closeBtn.addEventListener("click", function () {
      // Set state immediately to block scroll listener
      isDismissed = true;
      localStorage.setItem('cta_popup_closed', 'true');

      cta.classList.add('translate-y-10', 'opacity-0');
      setTimeout(() => {
        cta.classList.add('hidden');
      }, 500);
    });
  });
</script>